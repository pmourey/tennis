<!-- templates/list_championships.html -->
{% extends 'base.html' %}
{% include './partials/_menu.html' %}

{% block main %}
<main>
    <!-- Season filter -->
    <div style="margin-bottom: 20px;">
        <label for="season-filter">Filtrer par année sportive :</label>
        <select id="season-filter" onchange="filterBySeason()">
            {% for season in available_seasons %}
                <option value="{{ season }}" {% if season == selected_season %}selected{% endif %}>
                    {{ season }}{% if season == current_season %} (actuelle){% endif %}
                </option>
            {% endfor %}
        </select>
    </div>
    
    {% if championships %}
    <table class="championships">
        <caption class="table-caption">Liste des championnats - {{ selected_season }}</caption>
        <thead>
        <tr>
            <th>Nom</th>
            <th>Nb équipes</th>
            <th>Nb poules</th>
            <th>Nb journées</th>
            <th>Nb simples / doubles</th>
            <th>Période</th>
            <th>Action</th>
        </tr>
        </thead>
        {% for championship in championships %}
        {% set exempted_pool = 1 if championship.exempted_teams else 0 %}
        {% set singles_label = 'simples' if championship.singlesCount > 1 else 'simple' %}
        {% set doubles_label = 'doubles' if championship.doublesCount > 1 else 'double' %}
        {% set start_date = championship.start_date.strftime('%d/%m') if championship.start_date else '' %}
        {% set end_date = championship.end_date.strftime('%d/%m') if championship.end_date else '' %}
        <div id="pool">
            <tr>
                <td><a href="{{ url_for('championship.show_pools', id=championship.id) }}">{{ championship.name }}</a></td>
                <td>{{ championship.teams|length }}</td>
                <td>{{ championship.pools|length - exempted_pool }}</td>
                <td>{{ championship.matchdays|length }}</td>
                <td>{{ championship.singlesCount }} {{singles_label}} / {{ championship.doublesCount }} {{doubles_label}}</td>
                <td>{{ start_date }}-{{ end_date }}</td>
<!--                <td>-->
<!--                    <form action="{{ url_for('championship.simulate_championship', championship_id=championship.id) }}" method="post">-->
<!--                        <input type="submit" value="Simulate" onclick="return confirm('Are you sure you want to simulate this championship?\nThis will takes about 2 minutes!')">-->
<!--                    </form>-->
<!--                </td>-->
                <td>
                    <form action="{{ url_for('championship.delete_championship', championship_id=championship.id) }}" method="post">
                        <input type="submit" value="Delete" onclick="return confirm('Are you sure you want to delete this championship?')">
                    </form>
                </td>
            </tr>
        </div>
        {%endfor %}
    </table>
    {% else %}
    <p style="font-size: 16px; text-align: center;">Pas de championnat pour la saison {{ selected_season }}! ✌️</p>
    {% endif %}
</main>

<script>
function filterBySeason() {
    const select = document.getElementById('season-filter');
    const selectedSeason = select.value;
    window.location.href = '{{ url_for("championship.show_championships") }}?season=' + selectedSeason;
}
</script>

{% endblock main %}
